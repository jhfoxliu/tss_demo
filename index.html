<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hierarchical Figure Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        #filters {
            margin-bottom: 20px;
        }
        select {
            margin: 5px;
            padding: 5px;
        }
        img {
            max-width: 80%;
            height: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h2>Select Sample, Method, Gene, and TSS</h2>
    
    <div id="filters">
        <label for="sample-selector">Sample:</label>
        <select id="sample-selector">
            <option value="">Select Sample</option>
        </select>

        <label for="method-selector">Method:</label>
        <select id="method-selector" disabled>
            <option value="">Select Method</option>
        </select>

        <label for="gene-selector">Gene:</label>
        <select id="gene-selector" disabled>
            <option value="">Select Gene</option>
        </select>

        <label for="tss-selector">TSS:</label>
        <select id="tss-selector" disabled>
            <option value="">Select TSS</option>
        </select>
    </div>

    <h3>Selected Figure</h3>
    <div id="figure-container">
        <img id="figure" src="" alt="Selected Figure">
    </div>

    <script>
        const repoOwner = "jhfoxliu";  // Change to your GitHub username
        const repoName = "tss_demo";       // Change to your repository name
        const jsonURL = `https://${repoOwner}.github.io/${repoName}/figures.json`;  // Hosted JSON file

        let figureData = {};

        async function fetchFigures() {
            try {
                const response = await fetch(jsonURL);
                if (!response.ok) throw new Error("Failed to fetch JSON");
                figureData = await response.json();
                populateSampleSelector();
            } catch (error) {
                console.error("Error loading JSON:", error);
            }
        }

        function populateSampleSelector() {
            const sampleSelector = document.getElementById("sample-selector");
            sampleSelector.innerHTML = '<option value="">Select Sample</option>'; // Reset
            
            Object.keys(figureData).forEach(sample => {
                let option = document.createElement("option");
                option.value = sample;
                option.textContent = sample;
                sampleSelector.appendChild(option);
            });

            disableSelectors(["method-selector", "gene-selector", "tss-selector"]);
        }

        function populateMethodSelector() {
            const sample = document.getElementById("sample-selector").value;
            const methodSelector = document.getElementById("method-selector");
            methodSelector.innerHTML = '<option value="">Select Method</option>'; // Reset
            
            if (sample && figureData[sample]) {
                Object.keys(figureData[sample]).forEach(method => {
                    let option = document.createElement("option");
                    option.value = method;
                    option.textContent = method;
                    methodSelector.appendChild(option);
                });

                methodSelector.disabled = false;
            } else {
                disableSelectors(["method-selector", "gene-selector", "tss-selector"]);
            }
        }

        function populateGeneSelector() {
            const sample = document.getElementById("sample-selector").value;
            const method = document.getElementById("method-selector").value;
            const geneSelector = document.getElementById("gene-selector");
            geneSelector.innerHTML = '<option value="">Select Gene</option>'; // Reset
            
            if (sample && method && figureData[sample] && figureData[sample][method]) {
                Object.keys(figureData[sample][method]).forEach(gene => {
                    let option = document.createElement("option");
                    option.value = gene;
                    option.textContent = gene;
                    geneSelector.appendChild(option);
                });

                geneSelector.disabled = false;
            } else {
                disableSelectors(["gene-selector", "tss-selector"]);
            }
        }

        function populateTSSSelector() {
            const sample = document.getElementById("sample-selector").value;
            const method = document.getElementById("method-selector").value;
            const gene = document.getElementById("gene-selector").value;
            const tssSelector = document.getElementById("tss-selector");
            tssSelector.innerHTML = '<option value="">Select TSS</option>'; // Reset
            
            if (sample && method && gene && figureData[sample][method] && figureData[sample][method][gene]) {
                Object.keys(figureData[sample][method][gene]).forEach(tss => {
                    let option = document.createElement("option");
                    option.value = tss;
                    option.textContent = tss;
                    tssSelector.appendChild(option);
                });

                tssSelector.disabled = false;
            } else {
                disableSelectors(["tss-selector"]);
            }
        }

        function updateFigure() {
            const sample = document.getElementById("sample-selector").value;
            const method = document.getElementById("method-selector").value;
            const gene = document.getElementById("gene-selector").value;
            const tss = document.getElementById("tss-selector").value;
            const figure = document.getElementById("figure");

            if (sample && method && gene && tss && figureData[sample][method][gene][tss]) {
                figure.src = `https://${repoOwner}.github.io/${repoName}/${figureData[sample][method][gene][tss]}`;
            } else {
                figure.src = "";
            }
        }

        function disableSelectors(selectors) {
            selectors.forEach(id => {
                document.getElementById(id).innerHTML = '<option value="">Select</option>';
                document.getElementById(id).disabled = true;
            });
        }

        document.getElementById("sample-selector").addEventListener("change", () => {
            populateMethodSelector();
            updateFigure();
        });

        document.getElementById("method-selector").addEventListener("change", () => {
            populateGeneSelector();
            updateFigure();
        });

        document.getElementById("gene-selector").addEventListener("change", () => {
            populateTSSSelector();
            updateFigure();
        });

        document.getElementById("tss-selector").addEventListener("change", updateFigure);

        fetchFigures(); // Load figure data
    </script>
</body>
</html>
