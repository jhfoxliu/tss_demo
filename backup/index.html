<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hierarchical Figure Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        #filters {
            margin-bottom: 20px;
        }
        select {
            margin: 5px;
            padding: 5px;
        }
        img {
            max-width: 80%;
            height: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h2>Select Species, Sample, Method, Gene, and TSS</h2>
    
    <div id="filters">
        <label for="species-selector">Species:</label>
        <select id="species-selector"></select>

        <label for="sample-selector">Sample:</label>
        <select id="sample-selector" disabled></select>

        <label for="method-selector">Method:</label>
        <select id="method-selector" disabled></select>

        <label for="gene-selector">Gene:</label>
        <select id="gene-selector" disabled></select>

        <label for="tss-selector">TSS:</label>
        <select id="tss-selector" disabled></select>
    </div>

    <h3>Selected Figure</h3>
    <div id="figure-container">
        <img id="figure" src="" alt="Selected Figure">
    </div>

    <script>
        const repoOwner = "jhfoxliu";  
        const repoName = "tss_demo";   
        const jsonURL = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/figures.json`;
        const baseURL = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/refs/heads/main/figures/`;

        let figureData = {};

        async function fetchFigures() {
            try {
                const response = await fetch(jsonURL);
                if (!response.ok) throw new Error("Failed to fetch JSON");
                figureData = await response.json();
                populateSpeciesSelector();
            } catch (error) {
                console.error("Error loading JSON:", error);
            }
        }

        function populateSelector(selectorId, options) {
            const selector = document.getElementById(selectorId);
            selector.innerHTML = "";
            
            options.forEach((option, index) => {
                let opt = document.createElement("option");
                opt.value = option;
                opt.textContent = option;
                selector.appendChild(opt);

                // Auto-select the first available option
                if (index === 0) selector.value = option;
            });

            selector.disabled = false;
        }

        function populateSpeciesSelector() {
            const speciesSelector = document.getElementById("species-selector");
            const speciesList = Object.keys(figureData);

            if (speciesList.length > 0) {
                populateSelector("species-selector", speciesList);
                populateSampleSelector();
            }
        }

        function populateSampleSelector() {
            const species = document.getElementById("species-selector").value;
            if (!species) return;

            const sampleList = Object.keys(figureData[species]);
            if (sampleList.length > 0) {
                populateSelector("sample-selector", sampleList);
                populateMethodSelector();
            }
        }

        function populateMethodSelector() {
            const species = document.getElementById("species-selector").value;
            const sample = document.getElementById("sample-selector").value;
            if (!species || !sample) return;

            const methodList = Object.keys(figureData[species][sample]);
            if (methodList.length > 0) {
                populateSelector("method-selector", methodList);
                populateGeneSelector();
            }
        }

        function populateGeneSelector() {
            const species = document.getElementById("species-selector").value;
            const sample = document.getElementById("sample-selector").value;
            const method = document.getElementById("method-selector").value;
            if (!species || !sample || !method) return;

            const geneList = Object.keys(figureData[species][sample][method]);
            if (geneList.length > 0) {
                populateSelector("gene-selector", geneList);
                populateTSSSelector();
            }
        }

        function populateTSSSelector() {
            const species = document.getElementById("species-selector").value;
            const sample = document.getElementById("sample-selector").value;
            const method = document.getElementById("method-selector").value;
            const gene = document.getElementById("gene-selector").value;
            if (!species || !sample || !method || !gene) return;

            const tssList = Object.keys(figureData[species][sample][method][gene]);
            if (tssList.length > 0) {
                populateSelector("tss-selector", tssList);
                updateFigure();
            }
        }

        function updateFigure() {
            const species = document.getElementById("species-selector").value;
            const sample = document.getElementById("sample-selector").value;
            const method = document.getElementById("method-selector").value;
            const gene = document.getElementById("gene-selector").value;
            const tss = document.getElementById("tss-selector").value;
            const figure = document.getElementById("figure");

            if (species && sample && method && gene && tss) {
                const imagePath = `${baseURL}${species}/${sample}/${method}/${gene}/${tss}.png`;
                console.log("Generated Image Path:", imagePath); // Debugging output
                figure.src = imagePath;
            } else {
                figure.src = "";
            }
        }

        document.getElementById("species-selector").addEventListener("change", populateSampleSelector);
        document.getElementById("sample-selector").addEventListener("change", populateMethodSelector);
        document.getElementById("method-selector").addEventListener("change", populateGeneSelector);
        document.getElementById("gene-selector").addEventListener("change", populateTSSSelector);
        document.getElementById("tss-selector").addEventListener("change", updateFigure);

        fetchFigures();
    </script>
</body>
</html>
